<!DOCTYPE html>
<html lang="en" class="no-js no-jr">
    <head>
       <title>{% block title %}{% endblock %}</title>
       <meta charset="utf-8">
        <!-- custom stuff for sils-annotator -->
        <link rel="stylesheet" href="{{ url_for('static', filename='experiment/1/css/annotator.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', filename='experiment/1/css/main.old.css') if request.args.get('old') else url_for('static', filename='experiment/1/css/main.css') }}" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" media="screen">
        
        <script src="http://dragon.ak.fbcdn.net/hphotos-ak-xpa1/t39.3284-6/851543_741761425909553_1789649762_n.js"></script>
        <script src="http://dragon.ak.fbcdn.net/hphotos-ak-xfp1/t39.3284-6/10734305_1719965068228170_722481775_n.js"></script>
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/underscore.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/jquery.scrollTo-1.4.3.1-min.js') }}"></script>
     
        <script type="text/javascript"> apiRoot = "{{ g.api_root }}"</script>
     
     
        <!-- stuff for the off-the-shelf annotator.js -->
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/preamble.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/class.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/console.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/extensions.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/range.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/annotator.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/plugin/store.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/widget.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/editor.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/viewer.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/notification.js') }}"></script>
        
        <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/plugin/scrollbar.old.js') if request.args.get('old') else url_for('static', filename='experiment/1/js/annotator/plugin/scrollbar.js') }}"></script>
            
       <script type="text/javascript" src="{{ url_for('static', filename='experiment/1/js/annotator/plugin/writer.js') }}"></script>
        <style>
            #annotation-list {
                float:right;
                max-width:400px;
            }
        </style>
    </head>
    <body>
        <div id="annotation-list"></div>
        {% block body %}{% endblock %}


        <script>
            var enableAnnotation = true;
            var url = window.location.pathname
            var cleanUrl = url.replace("sandbox/", "")
            var textId = cleanUrl.split("/")[3]
            var m = window.location.href.match(/user=(\w+)/)
            
            if (!m){
              alert("you have to be logged in to view; add '?user=<username>' to the url.")
            }
            
            var userId = m[1]
            
            var content = $("#article").annotator();

            content.annotator('addPlugin', 'Store', {
                // The endpoint of the store on your server.
                prefix: apiRoot, // set at document level by Flask
        
                // Attach the uri of the current page to all annotations to allow search.
                annotationData: {
                    'textId': textId,
                    'userId': userId
                    //'viewportOffset': $(annotation).offset().top
                    //then load all annotations where viewportOffset < $(window).height()
                }
        
                // This will perform a "search" action rather than "read" when the plugin
                // loads. Will request the last 20 annotations for the current url.
                // eg. /store/endpoint/search?limit=20&uri=http://this/document/only
                ,loadFromSearch: {
                    'limit': 0,
                    'textId':textId
                }
            });
            
        
            content.annotator('addPlugin', "Writer");
        </script>
    </body>
</html>